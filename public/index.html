<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sharp Image Processing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            text-align: center;
            padding: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .upload-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed #ddd;
            text-align: center;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .upload-section input[type="file"] {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }

        .operations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .operation-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }

        .operation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .operation-card h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .operation-card h3::before {
            content: "üé®";
            margin-right: 10px;
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            display: none;
        }

        .error {
            background: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .preview {
            margin-top: 20px;
            text-align: center;
        }

        .preview img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .operations {
                grid-template-columns: 1fr;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Sharp Image Processing</h1>
            <p>Transform your images with powerful processing tools</p>
        </div>

        <div class="content">
            <div class="upload-section">
                <h2>üìÅ Select an Image</h2>
                <input type="file" id="imageFile" accept="image/*" required>
                <p>Choose an image file to start processing (JPEG, PNG, WebP supported)</p>
            </div>

            <div class="operations">
                <!-- Resize Operation -->
                <div class="operation-card">
                    <h3>üìè Resize Image</h3>
                    <div class="form-group">
                        <label>Width (pixels):</label>
                        <input type="number" id="resizeWidth" placeholder="e.g., 800" min="1">
                    </div>
                    <div class="form-group">
                        <label>Height (pixels):</label>
                        <input type="number" id="resizeHeight" placeholder="e.g., 600" min="1">
                    </div>
                    <button class="btn" onclick="resizeImage()">Resize Image</button>
                </div>

                <!-- Convert Format -->
                <div class="operation-card">
                    <h3>üîÑ Convert Format</h3>
                    <div class="form-group">
                        <label>Output Format:</label>
                        <select id="convertFormat">
                            <option value="jpeg">JPEG</option>
                            <option value="png">PNG</option>
                            <option value="webp">WebP</option>
                        </select>
                    </div>
                    <button class="btn" onclick="convertImage()">Convert Format</button>
                </div>

                <!-- Apply Filters -->
                <div class="operation-card">
                    <h3>‚ú® Apply Filters</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="greyscale">
                        <label>Greyscale</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="sharpen">
                        <label>Sharpen</label>
                    </div>
                    <div class="form-group">
                        <label>Blur (0-100):</label>
                        <input type="range" id="blur" min="0" max="100" value="0">
                        <span id="blurValue">0</span>
                    </div>
                    <div class="form-group">
                        <label>Brightness (0.1-3.0):</label>
                        <input type="range" id="brightness" min="0.1" max="3" step="0.1" value="1">
                        <span id="brightnessValue">1</span>
                    </div>
                    <div class="form-group">
                        <label>Contrast (0.1-3.0):</label>
                        <input type="range" id="contrast" min="0.1" max="3" step="0.1" value="1">
                        <span id="contrastValue">1</span>
                    </div>
                    <button class="btn" onclick="applyFilters()">Apply Filters</button>
                </div>

                <!-- Crop Image -->
                <div class="operation-card">
                    <h3>‚úÇÔ∏è Crop Image</h3>
                    <div class="form-group">
                        <label>Left (pixels):</label>
                        <input type="number" id="cropLeft" placeholder="e.g., 100" min="0">
                    </div>
                    <div class="form-group">
                        <label>Top (pixels):</label>
                        <input type="number" id="cropTop" placeholder="e.g., 100" min="0">
                    </div>
                    <div class="form-group">
                        <label>Width (pixels):</label>
                        <input type="number" id="cropWidth" placeholder="e.g., 400" min="1">
                    </div>
                    <div class="form-group">
                        <label>Height (pixels):</label>
                        <input type="number" id="cropHeight" placeholder="e.g., 300" min="1">
                    </div>
                    <button class="btn" onclick="cropImage()">Crop Image</button>
                </div>

                <!-- Composite Images -->
                <div class="operation-card">
                    <h3>üîÄ Composite Images</h3>
                    <div class="form-group">
                        <label>Base Image:</label>
                        <input type="file" id="baseImage" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label>Overlay Image:</label>
                        <input type="file" id="overlayImage" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label>Position X (optional):</label>
                        <input type="number" id="compositeLeft" placeholder="e.g., 100">
                    </div>
                    <div class="form-group">
                        <label>Position Y (optional):</label>
                        <input type="number" id="compositeTop" placeholder="e.g., 100">
                    </div>
                    <div class="form-group">
                        <label>Blend Mode:</label>
                        <select id="blendMode">
                            <option value="">Normal</option>
                            <option value="multiply">Multiply</option>
                            <option value="screen">Screen</option>
                            <option value="overlay">Overlay</option>
                            <option value="darken">Darken</option>
                            <option value="lighten">Lighten</option>
                            <option value="difference">Difference</option>
                            <option value="add">Add</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Gravity:</label>
                        <select id="gravity">
                            <option value="">Custom Position</option>
                            <option value="center">Center</option>
                            <option value="north">Top</option>
                            <option value="south">Bottom</option>
                            <option value="east">Right</option>
                            <option value="west">Left</option>
                            <option value="northeast">Top Right</option>
                            <option value="northwest">Top Left</option>
                            <option value="southeast">Bottom Right</option>
                            <option value="southwest">Bottom Left</option>
                        </select>
                    </div>
                    <button class="btn" onclick="compositeImages()">Composite Images</button>
                </div>

                <!-- Create Collage -->
                <div class="operation-card">
                    <h3>üñºÔ∏è Create Collage</h3>
                    <div class="form-group">
                        <label>Select Multiple Images:</label>
                        <input type="file" id="collageImages" accept="image/*" multiple>
                    </div>
                    <div class="form-group">
                        <label>Columns:</label>
                        <input type="number" id="collageColumns" placeholder="e.g., 3" min="1" value="3">
                    </div>
                    <div class="form-group">
                        <label>Spacing (pixels):</label>
                        <input type="number" id="collageSpacing" placeholder="e.g., 10" min="0" value="10">
                    </div>
                    <div class="form-group">
                        <label>Background Color:</label>
                        <input type="color" id="backgroundColor" value="#ffffff">
                    </div>
                    <button class="btn" onclick="createCollage()">Create Collage</button>
                </div>

                <!-- Add Watermark -->
                <div class="operation-card">
                    <h3>üíß Add Watermark</h3>
                    <div class="form-group">
                        <label>Watermark Text:</label>
                        <input type="text" id="watermarkText" placeholder="e.g., ¬© Your Name">
                    </div>
                    <div class="form-group">
                        <label>Font Size:</label>
                        <input type="number" id="watermarkFontSize" placeholder="48" min="12" max="200" value="48">
                    </div>
                    <div class="form-group">
                        <label>Font Family:</label>
                        <select id="watermarkFontFamily">
                            <option value="Arial">Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Helvetica">Helvetica</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Verdana">Verdana</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Text Color:</label>
                        <input type="color" id="watermarkColor" value="#ffffff">
                    </div>
                    <div class="form-group">
                        <label>Opacity (0-1):</label>
                        <input type="range" id="watermarkOpacity" min="0" max="1" step="0.1" value="0.7">
                        <span id="watermarkOpacityValue">0.7</span>
                    </div>
                    <div class="form-group">
                        <label>Position:</label>
                        <select id="watermarkPosition">
                            <option value="southeast">Bottom Right</option>
                            <option value="southwest">Bottom Left</option>
                            <option value="northeast">Top Right</option>
                            <option value="northwest">Top Left</option>
                            <option value="center">Center</option>
                            <option value="north">Top Center</option>
                            <option value="south">Bottom Center</option>
                            <option value="east">Right Center</option>
                            <option value="west">Left Center</option>
                        </select>
                    </div>
                    <button class="btn" onclick="addWatermark()">Add Watermark</button>
                </div>

                <!-- Add Border -->
                <div class="operation-card">
                    <h3>üñºÔ∏è Add Border</h3>
                    <div class="form-group">
                        <label>Border Width (pixels):</label>
                        <input type="number" id="borderWidth" placeholder="e.g., 20" min="1" value="10">
                    </div>
                    <div class="form-group">
                        <label>Border Height (optional):</label>
                        <input type="number" id="borderHeight" placeholder="Same as width" min="1">
                    </div>
                    <div class="form-group">
                        <label>Border Color:</label>
                        <input type="color" id="borderColor" value="#000000">
                    </div>
                    <button class="btn" onclick="addBorder()">Add Border</button>
                </div>

                <!-- Apply Mask -->
                <div class="operation-card">
                    <h3>üé≠ Apply Mask</h3>
                    <div class="form-group">
                        <label>Mask Type:</label>
                        <select id="maskType">
                            <option value="circle">Circle</option>
                            <option value="rounded">Rounded Rectangle</option>
                            <option value="star">Star</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Radius (optional):</label>
                        <input type="number" id="maskRadius" placeholder="Auto calculate" min="1">
                    </div>
                    <div class="form-group">
                        <label>Background Color:</label>
                        <input type="color" id="maskBackgroundColor" value="#ffffff">
                    </div>
                    <button class="btn" onclick="applyMask()">Apply Mask</button>
                </div>

                <!-- Rotate Image -->
                <div class="operation-card">
                    <h3>üîÑ Rotate Image</h3>
                    <div class="form-group">
                        <label>Rotation Angle (degrees):</label>
                        <input type="number" id="rotateAngle" placeholder="e.g., 90, 180, 270, 45" step="1" value="90">
                    </div>
                    <div class="form-group">
                        <label>Background Color:</label>
                        <input type="color" id="rotateBackgroundColor" value="#ffffff">
                    </div>
                    <div style="margin: 10px 0;">
                        <button class="btn" style="width: 23%; margin: 1%;" onclick="quickRotate(90)">90¬∞</button>
                        <button class="btn" style="width: 23%; margin: 1%;" onclick="quickRotate(180)">180¬∞</button>
                        <button class="btn" style="width: 23%; margin: 1%;" onclick="quickRotate(270)">270¬∞</button>
                        <button class="btn" style="width: 23%; margin: 1%;" onclick="quickRotate(-90)">-90¬∞</button>
                    </div>
                    <button class="btn" onclick="rotateImage()">Rotate Custom</button>
                </div>

                <!-- Flip Image -->
                <div class="operation-card">
                    <h3>üîÄ Flip Image</h3>
                    <div class="form-group">
                        <label>Flip Direction:</label>
                        <select id="flipDirection">
                            <option value="horizontal">Horizontal (‚Üî)</option>
                            <option value="vertical">Vertical (‚Üï)</option>
                            <option value="both">Both (‚Üó)</option>
                        </select>
                    </div>
                    <div style="margin: 10px 0;">
                        <button class="btn" style="width: 32%; margin: 1%;" onclick="quickFlip('horizontal')">‚Üî Horizontal</button>
                        <button class="btn" style="width: 32%; margin: 1%;" onclick="quickFlip('vertical')">‚Üï Vertical</button>
                        <button class="btn" style="width: 32%; margin: 1%;" onclick="quickFlip('both')">‚Üó Both</button>
                    </div>
                    <button class="btn" onclick="flipImage()">Apply Flip</button>
                </div>

                <!-- Advanced Transform -->
                <div class="operation-card">
                    <h3>üéõÔ∏è Advanced Transform</h3>
                    <div class="form-group">
                        <label>Rotation Angle (degrees):</label>
                        <input type="number" id="transformAngle" placeholder="Optional" step="0.1">
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="transformFlip">
                        <label>Flip Vertical (‚Üï)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="transformFlop">
                        <label>Flip Horizontal (‚Üî)</label>
                    </div>
                    <div class="form-group">
                        <label>Background Color:</label>
                        <input type="color" id="transformBackgroundColor" value="#ffffff">
                    </div>
                    <button class="btn" onclick="transformImage()">Apply Transform</button>
                </div>

                <!-- Color Adjust -->
                <div class="operation-card">
                    <h3>üé® Color Adjust</h3>
                    <div class="form-group">
                        <label>Tint Color:</label>
                        <input type="color" id="colorTint" value="#ffffff">
                    </div>
                    <div class="form-group">
                        <label>Gamma (0.1-3.0):</label>
                        <input type="range" id="colorGamma" min="0.1" max="3" step="0.1" value="1">
                        <span id="colorGammaValue">1</span>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="colorNegate">
                        <label>Negate (Invert colors)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="colorNormalize">
                        <label>Normalize (Auto-levels)</label>
                    </div>
                    <button class="btn" onclick="adjustColor()">Adjust Color</button>
                </div>

                <!-- Colorspace -->
                <div class="operation-card">
                    <h3>üåà Colorspace</h3>
                    <div class="form-group">
                        <label>Target Colorspace:</label>
                        <select id="colorspace">
                            <option value="srgb">sRGB</option>
                            <option value="rgb16">RGB16</option>
                            <option value="cmyk">CMYK</option>
                            <option value="lab">LAB</option>
                            <option value="b-w">Black & White</option>
                        </select>
                    </div>
                    <button class="btn" onclick="convertColorspace()">Convert Colorspace</button>
                </div>

                <!-- Channel Operations -->
                <div class="operation-card">
                    <h3>üì∫ Channel Operations</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="channelRemoveAlpha">
                        <label>Remove Alpha Channel</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="channelEnsureAlpha">
                        <label>Ensure Alpha Channel</label>
                    </div>
                    <div class="form-group">
                        <label>Extract Channel:</label>
                        <select id="extractChannel">
                            <option value="">None</option>
                            <option value="red">Red</option>
                            <option value="green">Green</option>
                            <option value="blue">Blue</option>
                            <option value="alpha">Alpha</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Band Boolean Operation:</label>
                        <select id="bandBoolOperation">
                            <option value="">None</option>
                            <option value="and">AND</option>
                            <option value="or">OR</option>
                            <option value="eor">EOR (XOR)</option>
                        </select>
                    </div>
                    <button class="btn" onclick="channelOperations()">Apply Channel Ops</button>
                </div>

                <!-- Utility Info -->
                <div class="operation-card">
                    <h3>üîß Utility Info</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="utilityStats">
                        <label>Get Statistics</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="utilityHistogram">
                        <label>Get Histogram</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="utilityDominant">
                        <label>Get Dominant Color</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="utilityClone">
                        <label>Clone Image</label>
                    </div>
                    <button class="btn" onclick="getUtilityInfo()">Get Utility Info</button>
                </div>

                <!-- Create Thumbnails -->
                <div class="operation-card">
                    <h3>üñºÔ∏è Create Thumbnails</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="thumbSmall" checked>
                        <label>Small (150x150)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="thumbMedium" checked>
                        <label>Medium (300x300)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="thumbLarge" checked>
                        <label>Large (600x600)</label>
                    </div>
                    <button class="btn" onclick="createThumbnails()">Create Thumbnails</button>
                </div>

                <!-- Utility Pipeline -->
                <div class="operation-card">
                    <h3>‚öôÔ∏è Utility Pipeline</h3>
                    <p>Select operations to apply in sequence:</p>
                    <div class="checkbox-group">
                        <input type="checkbox" id="pipeGreyscale">
                        <label>Greyscale</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="pipeNegate">
                        <label>Negate</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="pipeNormalize">
                        <label>Normalize</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="pipeSharpen">
                        <label>Sharpen</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="pipeBlur">
                        <label>Blur</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="pipeFlip">
                        <label>Flip</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="pipeFlop">
                        <label>Flop</label>
                    </div>
                    <button class="btn" onclick="utilityPipeline()">Run Pipeline</button>
                </div>

                <!-- Background Removal -->
                <div class="operation-card">
                    <h3>üé≠ Remove Background</h3>
                    <div class="form-group">
                        <label>Method:</label>
                        <select id="bgMethod">
                            <option value="default">Default (Edge Detection)</option>
                            <option value="threshold">Threshold</option>
                            <option value="edge">Edge Detection</option>
                            <option value="color">Color Removal</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Threshold (0-255):</label>
                        <input type="range" id="bgThreshold" min="0" max="255" value="128">
                        <span id="bgThresholdValue">128</span>
                    </div>
                    <div class="form-group">
                        <label>Color to Remove:</label>
                        <input type="color" id="bgColor" value="#ffffff">
                    </div>
                    <div class="form-group">
                        <label>Tolerance (0-100):</label>
                        <input type="range" id="bgTolerance" min="0" max="100" value="10">
                        <span id="bgToleranceValue">10</span>
                    </div>
                    <button class="btn" onclick="removeBackground()">Remove Background</button>
                </div>

                <!-- Smart Background Removal -->
                <div class="operation-card">
                    <h3>üß† Smart Background Removal</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="smartEdgeDetection" checked>
                        <label>Edge Detection</label>
                    </div>
                    <div class="form-group">
                        <label>Color Threshold (0-255):</label>
                        <input type="range" id="smartColorThreshold" min="0" max="255" value="50">
                        <span id="smartColorThresholdValue">50</span>
                    </div>
                    <div class="form-group">
                        <label>Blur (0-10):</label>
                        <input type="range" id="smartBlur" min="0" max="10" value="1">
                        <span id="smartBlurValue">1</span>
                    </div>
                    <div class="form-group">
                        <label>Feather (0-10):</label>
                        <input type="range" id="smartFeather" min="0" max="10" value="2">
                        <span id="smartFeatherValue">2</span>
                    </div>
                    <button class="btn" onclick="smartRemoveBackground()">Smart Remove Background</button>
                </div>

                <!-- Get Image Info -->
                <div class="operation-card">
                    <h3>‚ÑπÔ∏è Image Information</h3>
                    <p>Upload an image to see its metadata and properties.</p>
                    <button class="btn" onclick="getImageInfo()">Get Image Info</button>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processing your image...</p>
            </div>

            <div class="result" id="result"></div>
            <div class="error" id="error"></div>
            <div class="preview" id="preview"></div>
        </div>
    </div>

    <script>
        // Update range values display
        document.getElementById('blur').addEventListener('input', function() {
            document.getElementById('blurValue').textContent = this.value;
        });

        document.getElementById('brightness').addEventListener('input', function() {
            document.getElementById('brightnessValue').textContent = this.value;
        });

        document.getElementById('contrast').addEventListener('input', function() {
            document.getElementById('contrastValue').textContent = this.value;
        });

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            document.getElementById('preview').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showResult(message, downloadUrl = null) {
            hideLoading();
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            if (downloadUrl) {
                resultDiv.innerHTML += `<br><br><a href="${downloadUrl}" download style="color: #667eea; font-weight: bold;">üì• Download Processed Image</a>`;
                showPreview(downloadUrl);
            }
            resultDiv.style.display = 'block';
        }

        function showError(message) {
            hideLoading();
            document.getElementById('error').innerHTML = message;
            document.getElementById('error').style.display = 'block';
        }

        function showPreview(imageUrl) {
            const previewDiv = document.getElementById('preview');
            previewDiv.innerHTML = `<h3>Preview:</h3><img src="${imageUrl}" alt="Processed Image">`;
            previewDiv.style.display = 'block';
        }

        function getFormData() {
            const fileInput = document.getElementById('imageFile');
            if (!fileInput.files[0]) {
                showError('Please select an image file first.');
                return null;
            }

            const formData = new FormData();
            formData.append('image', fileInput.files[0]);
            return formData;
        }

        async function resizeImage() {
            const formData = getFormData();
            if (!formData) return;

            const width = document.getElementById('resizeWidth').value;
            const height = document.getElementById('resizeHeight').value;

            if (!width || !height) {
                showError('Please enter both width and height values.');
                return;
            }

            formData.append('width', width);
            formData.append('height', height);

            showLoading();
            try {
                const response = await fetch('/images/resize', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function convertImage() {
            const formData = getFormData();
            if (!formData) return;

            const format = document.getElementById('convertFormat').value;
            formData.append('format', format);

            showLoading();
            try {
                const response = await fetch('/images/convert', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function applyFilters() {
            const formData = getFormData();
            if (!formData) return;

            const greyscale = document.getElementById('greyscale').checked;
            const sharpen = document.getElementById('sharpen').checked;
            const blur = document.getElementById('blur').value;
            const brightness = document.getElementById('brightness').value;
            const contrast = document.getElementById('contrast').value;

            if (greyscale) formData.append('greyscale', 'true');
            if (sharpen) formData.append('sharpen', 'true');
            if (blur > 0) formData.append('blur', blur);
            if (brightness != 1) formData.append('brightness', brightness);
            if (contrast != 1) formData.append('contrast', contrast);

            showLoading();
            try {
                const response = await fetch('/images/filters', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function cropImage() {
            const formData = getFormData();
            if (!formData) return;

            const left = document.getElementById('cropLeft').value;
            const top = document.getElementById('cropTop').value;
            const width = document.getElementById('cropWidth').value;
            const height = document.getElementById('cropHeight').value;

            if (!left || !top || !width || !height) {
                showError('Please enter all crop parameters (left, top, width, height).');
                return;
            }

            formData.append('left', left);
            formData.append('top', top);
            formData.append('width', width);
            formData.append('height', height);

            showLoading();
            try {
                const response = await fetch('/images/crop', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function getImageInfo() {
            const formData = getFormData();
            if (!formData) return;

            showLoading();
            try {
                const response = await fetch('/images/upload', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    const info = result.originalInfo;
                    const infoText = `
                        üìä <strong>Image Information:</strong><br><br>
                        <strong>Format:</strong> ${info.format}<br>
                        <strong>Dimensions:</strong> ${info.width} √ó ${info.height} pixels<br>
                        <strong>Channels:</strong> ${info.channels}<br>
                        <strong>File Size:</strong> ${(info.size / 1024).toFixed(2)} KB<br>
                        <strong>Has Alpha:</strong> ${info.hasAlpha ? 'Yes' : 'No'}<br>
                        <strong>Density:</strong> ${info.density || 'N/A'} DPI
                    `;
                    showResult(infoText);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        // Update watermark opacity value display
        document.getElementById('watermarkOpacity').addEventListener('input', function() {
            document.getElementById('watermarkOpacityValue').textContent = this.value;
        });

        async function compositeImages() {
            const baseFileInput = document.getElementById('baseImage');
            const overlayFileInput = document.getElementById('overlayImage');

            if (!baseFileInput.files[0] || !overlayFileInput.files[0]) {
                showError('Please select both base image and overlay image.');
                return;
            }

            const formData = new FormData();
            formData.append('images', baseFileInput.files[0]);
            formData.append('images', overlayFileInput.files[0]);

            const left = document.getElementById('compositeLeft').value;
            const top = document.getElementById('compositeTop').value;
            const blend = document.getElementById('blendMode').value;
            const gravity = document.getElementById('gravity').value;

            if (left) formData.append('left', left);
            if (top) formData.append('top', top);
            if (blend) formData.append('blend', blend);
            if (gravity) formData.append('gravity', gravity);

            showLoading();
            try {
                const response = await fetch('/images/composite', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function createCollage() {
            const fileInput = document.getElementById('collageImages');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showError('Please select at least one image for the collage.');
                return;
            }

            const formData = new FormData();
            Array.from(fileInput.files).forEach(file => {
                formData.append('images', file);
            });

            const columns = document.getElementById('collageColumns').value;
            const spacing = document.getElementById('collageSpacing').value;
            const backgroundColor = document.getElementById('backgroundColor').value;

            if (!columns || parseInt(columns) < 1) {
                showError('Please enter a valid number of columns.');
                return;
            }

            formData.append('columns', columns);
            formData.append('spacing', spacing);
            formData.append('backgroundColor', backgroundColor);

            showLoading();
            try {
                const response = await fetch('/images/collage', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function addWatermark() {
            const formData = getFormData();
            if (!formData) return;

            const text = document.getElementById('watermarkText').value;
            if (!text) {
                showError('Please enter watermark text.');
                return;
            }

            const fontSize = document.getElementById('watermarkFontSize').value;
            const fontFamily = document.getElementById('watermarkFontFamily').value;
            const color = document.getElementById('watermarkColor').value;
            const opacity = document.getElementById('watermarkOpacity').value;
            const position = document.getElementById('watermarkPosition').value;

            formData.append('text', text);
            formData.append('fontSize', fontSize);
            formData.append('fontFamily', fontFamily);
            formData.append('color', color);
            formData.append('opacity', opacity);
            formData.append('position', position);

            showLoading();
            try {
                const response = await fetch('/images/watermark', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function addBorder() {
            const formData = getFormData();
            if (!formData) return;

            const width = document.getElementById('borderWidth').value;
            const height = document.getElementById('borderHeight').value;
            const color = document.getElementById('borderColor').value;

            if (!width || parseInt(width) < 1) {
                showError('Please enter a valid border width.');
                return;
            }

            formData.append('width', width);
            if (height) formData.append('height', height);
            formData.append('color', color);

            showLoading();
            try {
                const response = await fetch('/images/border', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function applyMask() {
            const formData = getFormData();
            if (!formData) return;

            const type = document.getElementById('maskType').value;
            const radius = document.getElementById('maskRadius').value;
            const backgroundColor = document.getElementById('maskBackgroundColor').value;

            formData.append('type', type);
            if (radius) formData.append('radius', radius);
            formData.append('backgroundColor', backgroundColor);

            showLoading();
            try {
                const response = await fetch('/images/mask', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        // Rotate and flip functions
        async function rotateImage() {
            const formData = getFormData();
            if (!formData) return;

            const angle = document.getElementById('rotateAngle').value;
            const backgroundColor = document.getElementById('rotateBackgroundColor').value;

            if (!angle || isNaN(parseFloat(angle))) {
                showError('Please enter a valid rotation angle.');
                return;
            }

            formData.append('angle', angle);
            formData.append('backgroundColor', backgroundColor);

            showLoading();
            try {
                const response = await fetch('/images/rotate', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function quickRotate(angle) {
            const formData = getFormData();
            if (!formData) return;

            const backgroundColor = document.getElementById('rotateBackgroundColor').value;

            formData.append('angle', angle.toString());
            formData.append('backgroundColor', backgroundColor);

            showLoading();
            try {
                const response = await fetch('/images/rotate', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ Image rotated ${angle}¬∞ successfully`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function flipImage() {
            const formData = getFormData();
            if (!formData) return;

            const direction = document.getElementById('flipDirection').value;

            formData.append('direction', direction);

            showLoading();
            try {
                const response = await fetch('/images/rotate/flip', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function quickFlip(direction) {
            const formData = getFormData();
            if (!formData) return;

            formData.append('direction', direction);

            showLoading();
            try {
                const response = await fetch('/images/rotate/flip', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ Image flipped ${direction} successfully`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function transformImage() {
            const formData = getFormData();
            if (!formData) return;

            const angle = document.getElementById('transformAngle').value;
            const flip = document.getElementById('transformFlip').checked;
            const flop = document.getElementById('transformFlop').checked;
            const backgroundColor = document.getElementById('transformBackgroundColor').value;

            if (angle) formData.append('angle', angle);
            if (flip) formData.append('flip', 'true');
            if (flop) formData.append('flop', 'true');
            formData.append('backgroundColor', backgroundColor);

            showLoading();
            try {
                const response = await fetch('/images/rotate/transform', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        // Update gamma value display
        document.getElementById('colorGamma').addEventListener('input', function() {
            document.getElementById('colorGammaValue').textContent = this.value;
        });

        // Color functions
        async function adjustColor() {
            const formData = getFormData();
            if (!formData) return;

            const tint = document.getElementById('colorTint').value;
            const gamma = document.getElementById('colorGamma').value;
            const negate = document.getElementById('colorNegate').checked;
            const normalize = document.getElementById('colorNormalize').checked;

            if (tint !== '#ffffff') formData.append('tint', tint);
            if (gamma !== '1') formData.append('gamma', gamma);
            if (negate) formData.append('negate', 'true');
            if (normalize) formData.append('normalize', 'true');

            showLoading();
            try {
                const response = await fetch('/images/color/adjust', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function convertColorspace() {
            const formData = getFormData();
            if (!formData) return;

            const colorspace = document.getElementById('colorspace').value;
            formData.append('colorspace', colorspace);

            showLoading();
            try {
                const response = await fetch('/images/color/space', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        // Channel functions
        async function channelOperations() {
            const formData = getFormData();
            if (!formData) return;

            const removeAlpha = document.getElementById('channelRemoveAlpha').checked;
            const ensureAlpha = document.getElementById('channelEnsureAlpha').checked;
            const extractChannel = document.getElementById('extractChannel').value;
            const bandBoolOperation = document.getElementById('bandBoolOperation').value;

            if (removeAlpha) formData.append('removeAlpha', 'true');
            if (ensureAlpha) formData.append('ensureAlpha', 'true');
            if (extractChannel) formData.append('extractChannel', extractChannel);
            if (bandBoolOperation) formData.append('bandBoolOperation', bandBoolOperation);

            showLoading();
            try {
                const response = await fetch('/images/channel/operations', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        // Utility functions
        async function getUtilityInfo() {
            const formData = getFormData();
            if (!formData) return;

            const stats = document.getElementById('utilityStats').checked;
            const histogram = document.getElementById('utilityHistogram').checked;
            const dominant = document.getElementById('utilityDominant').checked;
            const clone = document.getElementById('utilityClone').checked;

            if (stats) formData.append('stats', 'true');
            if (histogram) formData.append('histogram', 'true');
            if (dominant) formData.append('dominant', 'true');
            if (clone) formData.append('clone', 'true');

            showLoading();
            try {
                const response = await fetch('/images/utility/info', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    let infoText = `‚úÖ ${result.message}<br><br>`;
                    
                    if (result.data.stats) {
                        infoText += `<strong>üìä Statistics:</strong><br>`;
                        const stats = result.data.stats;
                        infoText += `Channels: ${stats.channels}<br>`;
                        infoText += `Min: ${JSON.stringify(stats.min)}<br>`;
                        infoText += `Max: ${JSON.stringify(stats.max)}<br>`;
                        infoText += `Mean: ${JSON.stringify(stats.mean)}<br><br>`;
                    }
                    
                    if (result.data.histogram) {
                        infoText += `<strong>üìà Histogram:</strong> Available (${result.data.histogram.length} bins)<br><br>`;
                    }
                    
                    if (result.data.dominant) {
                        infoText += `<strong>üé® Dominant Color:</strong> ${JSON.stringify(result.data.dominant)}<br><br>`;
                    }

                    showResult(infoText, result.data.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function createThumbnails() {
            const formData = getFormData();
            if (!formData) return;

            const sizes = [];
            if (document.getElementById('thumbSmall').checked) {
                sizes.push({ width: 150, height: 150, suffix: 'thumb' });
            }
            if (document.getElementById('thumbMedium').checked) {
                sizes.push({ width: 300, height: 300, suffix: 'medium' });
            }
            if (document.getElementById('thumbLarge').checked) {
                sizes.push({ width: 600, height: 600, suffix: 'large' });
            }

            if (sizes.length === 0) {
                showError('Please select at least one thumbnail size.');
                return;
            }

            formData.append('sizes', JSON.stringify(sizes));

            showLoading();
            try {
                const response = await fetch('/images/utility/thumbnails', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    let resultText = `‚úÖ ${result.message}<br><br>`;
                    result.downloadUrls.forEach((url, index) => {
                        resultText += `<a href="${url}" download style="color: #667eea; font-weight: bold; margin-right: 10px;">üì• Download ${sizes[index].suffix}</a><br>`;
                    });
                    showResult(resultText);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function utilityPipeline() {
            const formData = getFormData();
            if (!formData) return;

            const operations = [];
            if (document.getElementById('pipeGreyscale').checked) operations.push('greyscale');
            if (document.getElementById('pipeNegate').checked) operations.push('negate');
            if (document.getElementById('pipeNormalize').checked) operations.push('normalize');
            if (document.getElementById('pipeSharpen').checked) operations.push('sharpen');
            if (document.getElementById('pipeBlur').checked) operations.push('blur');
            if (document.getElementById('pipeFlip').checked) operations.push('flip');
            if (document.getElementById('pipeFlop').checked) operations.push('flop');

            if (operations.length === 0) {
                showError('Please select at least one operation for the pipeline.');
                return;
            }

            formData.append('operations', operations.join(','));

            showLoading();
            try {
                const response = await fetch('/images/utility/pipeline', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}<br>Operations applied: ${operations.join(', ')}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function removeBackground() {
            const formData = getFormData();
            if (!formData) return;

            const method = document.getElementById('bgMethod').value;
            const threshold = document.getElementById('bgThreshold').value;
            const color = document.getElementById('bgColor').value;
            const tolerance = document.getElementById('bgTolerance').value;

            formData.append('method', method);
            formData.append('threshold', threshold);
            formData.append('color', color);
            formData.append('tolerance', tolerance);

            showLoading();
            try {
                const response = await fetch('/images/background/remove', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}<br>Method: ${method}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        async function smartRemoveBackground() {
            const formData = getFormData();
            if (!formData) return;

            const edgeDetection = document.getElementById('smartEdgeDetection').checked;
            const colorThreshold = document.getElementById('smartColorThreshold').value;
            const blur = document.getElementById('smartBlur').value;
            const feather = document.getElementById('smartFeather').value;

            formData.append('edgeDetection', edgeDetection.toString());
            formData.append('colorThreshold', colorThreshold);
            formData.append('blur', blur);
            formData.append('feather', feather);

            showLoading();
            try {
                const response = await fetch('/images/background/smart-remove', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult(`‚úÖ ${result.message}<br>Edge Detection: ${edgeDetection ? 'On' : 'Off'}`, result.downloadUrl);
                } else {
                    showError(`‚ùå Error: ${result.message || 'Unknown error'}`);
                }
            } catch (error) {
                showError(`‚ùå Network error: ${error.message}`);
            }
        }

        // Update range value displays for background removal
        document.getElementById('bgThreshold').addEventListener('input', function() {
            document.getElementById('bgThresholdValue').textContent = this.value;
        });

        document.getElementById('bgTolerance').addEventListener('input', function() {
            document.getElementById('bgToleranceValue').textContent = this.value;
        });

        document.getElementById('smartColorThreshold').addEventListener('input', function() {
            document.getElementById('smartColorThresholdValue').textContent = this.value;
        });

        document.getElementById('smartBlur').addEventListener('input', function() {
            document.getElementById('smartBlurValue').textContent = this.value;
        });

        document.getElementById('smartFeather').addEventListener('input', function() {
            document.getElementById('smartFeatherValue').textContent = this.value;
        });
    </script>
</body>
</html>
